---
title: "Cohort Revenue & Retention Analysis: A Bayesian Approach"
subtitle: PyData Berlin - July 2023
author: 
  - name: Dr. Juan Orduz
    url: https://juanitorduz.github.io/
    affiliations:
      - name: Mathematician & Data Scientist
format:
  revealjs:
    logo: images/juanitorduz_logo.gif
    transition: none
    slide-number: true
    chalkboard: 
      buttons: false
    preview-links: auto
    theme:
        - white
    highlight-style: github-dark
    footer: '<a href="https://juanitorduz.github.io/revenue_retention/">Cohort Revenue & Retention Analysis: A Bayesian Approach</a>'
---

## Outline

::: incremental

1. Introduction
2. Bottom-Up Approaches
3. Simple Cohort Retention Model
4. Retention Model with BART
5. Cohort Revenue-Retention Model
6. Remarks
7. References

:::

## Retention Matrix {.smaller}

![](images/retention_bart_files/retention_bart_9_0.png){fig-align="center"}

::: footer
[A Simple Cohort Retention Analysis in PyMC](https://juanitorduz.github.io/retention/)
:::

## Retention Matrix {.smaller}

![](images/retention_bart_files/retention_bart_9_0.png){fig-align="center"}

- **Cohort Age:** Age of the cohort in months.
- **Age:** Age of the cohort with respect to the observation time.
- **Month:** Month of the observation time (period).

##

### Retention Component

\begin{align*}
    \textrm{logit}(p) & = \text{BART}(\text{cohort age}, \text{age}, \text{month}) \\
    N_{\text{active}} & \sim \text{Binomial}(N_{\text{total}}, p)
\end{align*}

### Revenue Component

\begin{align*}
    \log(\lambda) = \: (& \text{intercept} \\
        & + \beta_{\text{cohort age}} \text{cohort age} \\
        & + \beta_{\text{age}} \text{age} \\
        & + \beta_{\text{cohort age} \times \text{age}} \text{cohort age} \times \text{age}) \\
    \text{Revenue} & \sim \text{Gamma}(N_{\text{active}}, \lambda)
\end{align*}


## Cohot Revenue-Retention Model

``` {.python code-line-numbers="|1-3|5-14|16-30"}
mu = pmb.BART(name="mu", X=x, Y=train_retention_logit, m=50, dims="obs")

p = pm.Deterministic(name="p", var=pm.math.invlogit(mu), dims="obs")

lam_log = pm.Deterministic(
    name="lam_log",
    var=intercept
    + b_age_scaled * age_scaled
    + b_cohort_age_scaled * cohort_age_scaled
    + b_age_cohort_age_interaction * age_scaled * cohort_age_scaled,
    dims="obs",
)

lam = pm.Deterministic(name="lam", var=pm.math.exp(lam_log), dims="obs")

n_active_users_estimated = pm.Binomial(
    name="n_active_users_estimated",
    n=n_users,
    p=p,
    observed=n_active_users,
    dims="obs",
)

x = pm.Gamma(
    name="revenue_estimated",
    alpha=n_active_users_estimated + eps,
    beta=lam,
    observed=revenue,
    dims="obs",
)
```

## Cohort Revenue-Retention Model

![](images/revenue_retention_files/revenue_retention_33_0.svg){fig-align="center"}


##  Revenue-Retention - Predictions

::: columns
::: {.column width="50%"}
![](images/revenue_retention_files/revenue_retention_66_0.png){fig-align="center"}
:::
::: {.column width="50%"}
![](images/revenue_retention_files/revenue_retention_66_0.png){fig-align="center"}
:::
:::

::: footer
:::

## References {.smaller}

### Blog Posts

- [A Simple Cohort Retention Analysis in PyMC](https://juanitorduz.github.io/retention/)

- [Cohort Retention Analysis with BART](https://juanitorduz.github.io/retention_bart/)

- [Cohort Revenue & Retention Analysis: A Bayesian Approach](https://juanitorduz.github.io/revenue_retention/)

### Packages

- [`pymc`](https://github.com/pymc-devs/pymc)
- [`pymc-bart`](https://github.com/pymc-devs/pymc-bart)

### Papers

- [BART: Bayesian additive regression trees](https://arxiv.org/abs/0806.3286)
- [Bayesian additive regression trees for probabilistic programming](https://arxiv.org/abs/2206.03619)

## Thank you!

[juanitorduz.github.io](https://juanitorduz.github.io/)

![](images/juanitorduz.png){.absolute top=0 right=0 width=600 height=600}